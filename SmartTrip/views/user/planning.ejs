<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Planning - SmartTrip</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/img/icon.jpg">
    <style>
        /* Footer */
        footer {
            position: relative;
            width: 100%;
            bottom: 0;
        }

        .highlight {
            background-color: #6ba3f6;
            color: white;
            border-radius: 20px;
            padding: 5px 15px;
            font-weight: bold;
            margin-top: 20px;
        }

        #policies li {
            color: gray;
        }
    </style>
</head>

<body>
     <!-- HEADER (Navbar) -->
     <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <h2><a class="navbar-brand-lg text-light text-decoration-none" href="#">SmartTrip</a></h2>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/user/index">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/user/weather">Weather Forcast</a></li>
                    <li class="nav-item"><a class="nav-link" href="/user/destinations">Destinations</a></li>
                    <li class="nav-item"><a class="nav-link" href="/user/bookings">Bookings</a></li>
                    <li class="nav-item"><a class="nav-link" href="/user/contact">Contact</a></li>
                    <li class="nav-item"><a class="nav-link" href="/user/profile">Profile</a></li>
                    <li class="nav-item"><a class="nav-link btn btn-danger text-white px-3" href="/user/logout">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Content -->
    <div class="container mt-4">
        <div class="row">
            <h2><%= city %></h2>
            <!-- Itinerary Section -->
            <div class="col-lg-8 mt-3">
                <ul class="nav nav-tabs">
                    <li class="nav-item"><a class="nav-link active" href="#itinerary" data-bs-toggle="tab">Itinerary</a></li>
                    <li class="nav-item"><a class="nav-link" href="#policies" data-bs-toggle="tab">Policies</a></li>
                </ul>

                <div class="tab-content mt-3">
                    <div class="tab-pane fade show active" id="itinerary">
                        
                        <div class="day-plan">
                            <h4><i class="bi bi-airplane"></i> Flight - <%= source%> to <%= destination %></h4>
                            <p class="text-danger">Please Note : You need to reach <%= destination %> on your own.</p>
                        </div>
                        <% if (planing.days && planing.days.length > 0) { %>
                            <% planing.days.forEach(day => { %>
                                <div class="day-plan">
                                    <h6 class="highlight">Day <%= day.day %></h6>
                                    <h4><%= day.plan %></h4>
                                    <h5>üçΩ Meal - Sunset With Dinner</h5>
                                    <h5> Ativity - On-Ground Tour Manager Assistancer</h5>
                                    <p>Enjoy personalised on-ground assistance from our multilingual tour manager. Stationed at the destination, the tour manager will help and guide you through the tour.</p>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="alert alert-warning">No plan available</div>
                        <% } %>
                    </div>

                    <div class="tab-pane fade p-3 border rounded" id="policies">
                        <h3>Cancellation & Date Change</h3>
                        <h5>Package Cancellation Policy</h5>
                        <p class="text-danger">Cancellation not possible after booking</p>
                        <h5>Package Date Change Policy</h5>
                        <p class="text-danger">Date change not possible after booking</p>
                        <h3>Terms and Conditions</h3>
                        <h5>Exclusions</h5>
                        <ul>
                            <li>Expenses of personal nature</li>
                            <li>Anything not mentioned under inclusions</li>
                        </ul>
                        <h5>Terms and Conditions</h5>
                        <ul>
                            <li>The itinerary is fixed and cannot be modified. Transportation shall be provided as per
                                the itinerary and will not be at disposal.</li>
                            <li>AC will not be functional anywhere in cool or hilly areas.</li>
                            <li>Entrance fee, parking and guide charges are not included in the packages.</li>
                            <li>In case of unavailability in the listed hotels, arrangement for an alternate
                                accommodation
                                will be made in a hotel of similar standard.</li>
                            <li>Certain hotels may ask for a security deposit during check-in, which is refundable at
                                check-out subject to the hotel policy.</li>
                            <li>The booking price does not include: Expenses of personal nature, such as laundry,
                                telephone
                                calls, room service, alcoholic beverages, mini bar charges, tips, portage, camera fees
                                etc.
                            </li>
                            <li>Any other items not mentioned under Inclusions are not included in the cost of the
                                booking.
                            </li>
                            <li>The package price does not include mandatory dinner charges levied by the hotels
                                especially during New Year and Christmas or any special occasions. SmartTrip shall try
                                to
                                communicate the same while booking the package. However SmartTrip may not have this
                                information readily available all the time.</li>
                            <li>Cost of deviation and cost of extension of the validity on your ticket is not included.
                            </li>
                            <li>For queries regarding cancellations and refunds, please refer to our Cancellation
                                Policy.
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Payment Section -->
            <div class="col-lg-4">
                <div class="alert alert-primary border rounded p-3 mt-5">
                    <h5>Price Details</h5>
                    
                    <div class="alert alert-primary">
                        <h6>Hotel Price -- Rs.<%= hotelprice * person %>
                        </h6>
                        <h6>Package Price -- Rs.<%= planing.price * person %>
                        </h6>
                        <h4>Total Price -- Rs.<%= totelprice %>
                        </h4>
                    </div>
                    <button id="rzp-button" class="btn btn-primary w-100">Proceed to Payment</button>
                </div>
            </div>
        </div>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- FOOTER -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <div class="row">
                <div class="col-md-4 mb-5 mt-5">
                    <img src="/img/icon_full.jpg" alt="Logo" width="200" class="mb-2">
                    <h4>Smart Travel Planner</h4>
                </div>
                <div class="col-md-4 mb-5 mt-5">
                    <h4>Quick Links</h4>
                    <ul class="list-unstyled">
                        <li><a href="/user/index" class="text-light text-decoration-none">Home</a></li>
                        <li><a href="/user/destinations" class="text-light text-decoration-none">Destinations</a></li>
                        <li><a href="/user/about" class="text-light text-decoration-none">About Us</a></li>
                        <li><a href="/user/contact" class="text-light text-decoration-none">Contact</a></li>
                        <li><a href="/user" class="text-light text-decoration-none">Logout</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-5 mt-5">
                    <h4>Follow Us On</h4>
                    <a href="https://www.facebook.com/" class="text-light mx-2"><i class="bi bi-facebook"></i></a>
                    <a href="https://x.com/" class="text-light mx-2"><i class="bi bi-twitter"></i></a>
                    <a href="https://www.instagram.com/" class="text-light mx-2"><i class="bi bi-instagram"></i></a>
                </div>
            </div>
            <div class="mt-3">
                <p class="mb-3">&copy;2025 SmartTrip. All Rights Reserved.</p>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    </footer>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
    $('#rzp-button').click(function (e) {
        e.preventDefault();
        
        var formData = {
            amount: "<%= totelprice %>",
            userId: "<%= user.id %>",
            planid: "<%= planing._id %>",
             propertyid: "<%= property && property._id ? property._id : '' %>",
            date: "<%= date %>",
            person: "<%= person %>"
        };

        console.log("Sending AJAX Request:", formData); // Debugging log

        $.ajax({
            url: "/user/planing",
            type: "POST",
            data: JSON.stringify(formData),
            contentType: "application/json",
            success: function (res) {
                if (res.success) {
                    var options = {
                        "key": res.key_id,
                        "amount": res.amount,
                        "currency": res.currency,
                        "order_id": res.order_id,
                        "name": "SmartTrip",
                        "description": "A planned trip",
                        "handler": function (response) {
                            $.ajax({
                                url: "/user/verify-payment",
                                type: "POST",
                                data: JSON.stringify({
                                    razorpay_order_id: res.order_id,
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_signature: response.razorpay_signature,
                                    userId: res.userId,
                                    planid: res.planid,
                                    propertyid: res.propertyid,
                                    date: res.date,
                                    person: res.person
                                }),
                                contentType: "application/json",
                                success: function (verifyRes) {
                                    if (verifyRes.success) {
                                        alert("Payment Successful! Booking Confirmed.");
                                        window.location.href = "/user/bookings";
                                    } else {
                                        alert("Payment verification failed!");
                                    }
                                },
                                error: function (err) {
                                    console.log("Verification Error:", err);
                                    alert("Error verifying payment!");
                                }
                            });
                        },
                        "prefill": {
                            "contact": "9999999999",
                            "name": "User Name",
                            "email": "user@example.com"
                        },
                        "theme": {
                            "color": "#528FF0"
                        }
                    };
                    var razorpayObject = new Razorpay(options);
                    razorpayObject.open();
                } else {
                    alert(res.msg);
                }
            },
            error: function (err) {
                console.log("AJAX Error:", err);
                alert("Failed to create order. Check console for details.");
            }
        });
    });
});

    </script>
</body>

</html>